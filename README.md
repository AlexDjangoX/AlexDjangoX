<div align="center">
  <h1>ğŸš€ AlexDjangoX</h1>
  <h3>Full-Stack Developer | AI Solutions</h3>
  
  <div style="margin: 20px 0;">
    <img src="https://img.shields.io/badge/Next.js-16-black?style=for-the-badge&logo=next.js&logoColor=white" alt="Next.js 16" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/React-19-61DAFB?style=for-the-badge&logo=react&logoColor=black" alt="React 19" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/TypeScript-5.9-007ACC?style=for-the-badge&logo=typescript&logoColor=white" alt="TypeScript 5.9" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/Tailwind_CSS-4.1-38B2AC?style=for-the-badge&logo=tailwind-css&logoColor=white" alt="Tailwind CSS 4.1" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/Prisma-7-2D3748?style=for-the-badge&logo=prisma&logoColor=white" alt="Prisma 7" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/OpenAI-412991?style=for-the-badge&logo=openai&logoColor=white" alt="OpenAI" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/Polar-0062FF?style=for-the-badge&logo=polar&logoColor=white" alt="Polar" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/Zuplo-FF00BD?style=for-the-badge&logo=zuplo&logoColor=white" alt="Zuplo" style="margin: 0 5px;" />
    <img src="https://img.shields.io/badge/Lexical-0668E1?style=for-the-badge&logo=meta&logoColor=white" alt="Lexical Editor" style="margin: 0 5px;" />
  </div>
</div>

---

## âš¡ **Quick Facts**

| **ğŸ¯ Focus**             | **ğŸ—ï¸ Architecture**  | **ğŸ¤– AI Integration** | **ğŸ§ª Testing**     |
| :----------------------- | :------------------- | :-------------------- | :----------------- |
| Full-Stack Development   | Multi-Tenant Systems | OpenAI GPT-4          | 100% Test Coverage |
| Enterprise Solutions     | Real-time Features   | Realtime API          | E2E Testing        |
| Polish Language Learning | Secure API Gateway   | Stream Chat           | TypeScript         |

---

## ğŸ’¡ **About Me**

<div style="font-size: 16px; line-height: 1.6;">

I am a **Full-Stack Developer** specializing in enterprise AI solutions and multi-tenant applications.

**ğŸ¯ My Expertise:**

- **Modern Web Technologies** - Next.js 16, React 19, TypeScript 5.9
- **AI Integration** - OpenAI GPT-4, Realtime API, Whisper, TTS, custom prompts
- **Enterprise Architecture** - Multi-tenant systems, secure APIs, payment processing
- **Polish Language Learning** - Combined technical & linguistic expertise with 20+ interactive learning modules

**ğŸš€ Current Project:**
**PoliLex** - A sophisticated AI-powered language learning platform demonstrating enterprise-level architecture, multi-tenancy, real-time AI integration, and production-ready DevOps practices.

</div>

---

## ğŸ¯ **Current Project: PoliLex**

<div align="center">

[![PoliLex Platform](https://img.shields.io/badge/PoliLex-AI%20Enhanced%20Polish%20Learning-red?style=for-the-badge&logo=language&logoColor=white)](https://lexical-verb.vercel.app/)

**Polish language learning platform with sophisticated full-stack architecture**

</div>

---

## ğŸ—ï¸ **Tech Stack Overview**

| **Category**                 | **Technology / Tools**                               | **Purpose**                                          |
| :--------------------------- | :--------------------------------------------------- | :--------------------------------------------------- |
| **Frontend**                 | Next.js 16, React 19                                 | Core application shell and interactive UI            |
|                              | TypeScript 5.9                                       | Type-safe client-side development                    |
|                              | Tailwind CSS 4, ShadCN                               | Design system, layout, and reusable UI components    |
|                              | Lexical Editor, Framer Motion                        | Rich authoring experience and high-quality motion    |
| **Backend & Infrastructure** | Prisma 7, PostgreSQL, Supabase                       | Type-safe data access and relational persistence     |
|                              | Clerk Auth, Polar, Stream Chat, Redis                | Authentication, payments, real-time messaging, cache |
| **Testing & Quality**        | Jest, React Testing Library                          | Unit and integration coverage for components & logic |
|                              | Playwright                                           | End-to-end browser regression on critical journeys   |
|                              | k6, Artillery                                        | Load and performance validation for APIs and flows   |
|                              | TypeScript (strict), Prisma, Zod, @t3-oss/env-nextjs | Static typing and schema validation across the stack |
|                              | ESLint, Prettier, import-sorting plugins             | Automated linting, formatting, and code consistency  |
| **AI & Integrations**        | OpenAI GPT-4, DALL-E 3                               | Language processing and image generation             |
|                              | OpenAI Realtime API, Whisper API, OpenAI TTS         | Real-time voice, speech-to-text, and text-to-speech  |
|                              | Tambo AI                                             | Conversational AI with persistent threads            |
|                              | Stream Chat                                          | Real-time chat and collaboration                     |

---

<h3 style="color: #fb923c; margin: 16px 0 24px 0; font-weight: 600; font-size: 1.1rem;">Click any section below to expand and read the details.</h3>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><path d="M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"/><path d="M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"/><path d="M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"/></svg>Key Achievements</strong> â€” Multi-tenant, security, AI, learning modules, Lexical editor</summary>

<div style="font-size: 16px; line-height: 1.6;">

### â€¢ Multi-Tenant Architecture

- **Authentication & Database Integration** - Sophisticated user management with role-based access control
- **Company portals** with isolated data and secure tenant boundaries
- **Multi-Organization Support** - Seamless switching between different company portals
- **Permission Management** - Granular access control for teachers, students, and admins
- **Data Isolation** - Company-specific data segregation with secure tenant boundaries

### â€¢ Enterprise Security & API Management

- **Zuplo API Gateway** - Secure API management, rate limiting, and enterprise-grade security
- **Enterprise Security** - Role-based access control & secure authentication
- **Performance Optimized** - SSR, edge caching, optimized database queries
- **Comprehensive Testing** - Unit, integration, and E2E test coverage

### â€¢ AI-Powered Features

- **GPT-4 Integration** - Personalized instruction and content generation
- **OpenAI Realtime API** - Voice conversations with real-time streaming responses
- **Whisper API** - Audio transcription for podcasts and video content
- **Text-to-Speech (TTS)** - AI-generated audio pronunciation
- **Stream Chat** - Real-time messaging with Firebase push notifications (see dedicated section below)
- **Tambo AI Chat Integration** - Advanced conversational AI with thread-based persistence, custom interactive components, and integrated token-based costing system (see dedicated section below)
- **Custom AI Prompts** - Specialized language learning prompts and instructions

### â€¢ Comprehensive Learning Modules

**Grammar Labs:**

- **Aspect Master** - Verb aspect practice with quizzes, challenges, and timeline visualization
- **Reflexive Lab** - Reflexive verb journeys with categories and templates
- **Preposition Lab** - Interactive preposition challenges with case governance
- **Motion Lab** - Verbs of motion (unidirectional/multidirectional pairs)
- **Verb Prefixes** - Perfective prefix forms and transformations
- **Conjugator** - Interactive Kanban board for verb conjugation practice

**Vocabulary & Practice:**

- **Counting** - Grammatical cases through counting 1-21 with contextual examples
- **Adjectives** - Comparative forms and interactive exercises
- **Adverbs** - Comparative and superlative forms practice
- **Nouns** - Auto-generated flashcards with translations
- **Occupations** - 5 interactive games (Flashcards, Quiz, Memory, Drag & Drop, Sentence Builder)
- **Word Wizard** - AI-assisted vocabulary building with audio pronunciation
- **Flashcards** - Customizable flashcards with example sentences
- **Cases** - Grammatical case mastery through fill-in-the-blank exercises
- **Days & Months** - Temporal vocabulary practice
- **Genealogy** - Interactive family tree drag-and-drop game

**Interactive Content:**

- **Lexical Editor** - Rich text editing with collaborative features
- **PDF Processing** - Document processing and annotation
- **Portable Documents** - PDF viewer with highlighting capabilities
- **Podcasts** - Audio content with transcription
- **Videos** - Video learning with interactive features
- **Audio Transcript** - Speech-to-text processing

**Community & Social:**

- **Real-time Chat** - Stream Chat with FCM push notifications (see dedicated section)
- **Memory Games** - Polish language memory recall activities
- **Jira Integration** - Project management and task tracking
- **Company Portals** - Multi-tenant learning environments with blogs, videos, and PDFs

### â€¢ OpenAI Pricing Strategy

**Source of Truth:**

- **Database-Driven Pricing** - Centralized database table serves as the single source of truth for all OpenAI model costs
- **Manual Admin Management** - Pricing is manually updated by administrators through a secure admin interface (no automated scraping or external API dependencies)
- **Performance Optimization** - Server-side pricing cached with configurable TTL for optimal performance, with immediate cache invalidation after updates
- **Resilience** - Fallback pricing values available if database is temporarily unavailable (with appropriate logging and warnings)

**Security Practices:**

- **Defense in Depth** - Multi-layer security approach combining application-level authorization checks with database-level access controls
- **Row-Level Security** - Database policies enforce role-based access control, ensuring only authorized administrators can modify pricing data
- **Read Access** - Authenticated users can read active pricing information required for cost calculations
- **Write Access** - Strictly limited to authorized administrators through verified authentication mechanisms
- **Secure Initialization** - Seed scripts use secure service-level connections for initial data population
- **Token-Based Authorization** - Admin privileges verified through secure token claims validated at both application and database layers

### â€¢ Custom Lexical Editor with Media Integration

- **Rich Text Editing** - Full-featured Lexical editor with markdown support, tables, lists, and formatting
- **YouTube Integration** - Embed YouTube videos directly in editor content with resizable player controls
- **Audio/Podcast Integration** - Seamless audio embedding with Supabase storage integration
  - Audio playback controls with custom player interface
  - Podcast image support with signed URL generation
  - Audio transcription workflow integration
- **Video Content Creation** - Link videos to editor content for bilingual text generation
- **Speech-to-Text** - Built-in speech recognition plugin for voice input
- **Auto-Embed Plugin** - Automatic detection and embedding of YouTube URLs
- **Collaborative Features** - Real-time editing capabilities with history tracking
- **Export Capabilities** - Export editor content to blog posts and learning materials

### â€¢ Teacher/Tutor Portal (Company System)

- **Dedicated Company Portals** - Isolated multi-tenant environments for each teaching organization
- **Blog Management System** - Full-featured blog with Lexical editor integration
  - Rich text blog posts with embedded media
  - Tag-based categorization and filtering
  - Comments and reactions system
  - Nested comment threads with real-time updates
  - Author profiles and post attribution
  - Draft and published post status management
- **Video Library Management** - Comprehensive video content system
  - YouTube video integration with metadata
  - Difficulty level categorization (A1-C2)
  - Category organization (Grammar, Vocabulary, Pronunciation, etc.)
  - Bilingual text support (Polish/English)
  - Video transcription and summaries
  - Thumbnail and duration tracking
  - Publishing workflow
- **Resource Management** - Centralized content hub
  - PDF document management
  - Resource organization by company
  - Access control and permissions
- **Dashboard Analytics** - Company-specific insights and user management
- **Multi-User Support** - Role-based access for teachers, admins, and students
- **Tenant Isolation** - Secure data segregation between different companies

</div>

</details>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>Production Payment Infrastructure</strong> â€” Polar, subscriptions, webhooks, custom UI</summary>

<div align="center">
<em>Enterprise-grade subscription and payment system built with financial software engineering standards</em>
</div>

<br/>

**System Status:** âœ… **v2.3 â€” Production Ready & Live Validated** (January 28, 2026)

### â€¢ Strategic Migration: Stripe â†’ Polar

Migrated from Stripe to **Polar** for **international tax compliance** and simplified global operations. Polar acts as Merchant of Record, handling VAT, GST, and sales tax obligations across 100+ countriesâ€”eliminating the operational burden and legal exposure that Stripe leaves to merchants when selling internationally.

**Business Value:**

- âœ… **Automatic Tax Compliance** â€” Polar calculates, collects, and remits taxes globally
- âœ… **Merchant of Record** â€” Polar assumes tax liability as the legal seller
- âœ… **Zero Tax Registration** â€” Sell worldwide without jurisdiction-specific registrations
- âœ… **Simplified Operations** â€” Single integration, worldwide coverage, reduced overhead

### â€¢ System Architecture

**Design Principles:**

- **Financial Software Standards** â€” Zero tolerance for bugs where money is involved; 87% test coverage with 279 comprehensive tests
- **Database-Backed Idempotency** â€” All webhook events use stable keys with persistent storage; prevents double-crediting on retries
- **Fail-Closed for Money** â€” Balance mutations fail-closed; metadata sync fail-open for optimal reliability
- **Event-Driven Processing** â€” Asynchronous webhook handlers with state machine validation and transaction atomicity
- **Live Validated** â€” 100% congruency verified across Polar â†” Backend â†” Clerk â†” Frontend through comprehensive E2E testing
- **Custom UI Control** â€” In-app subscription management (v2.2) for 95% of operations, Polar portal for payment-sensitive 5%

| **Component**         | **Implementation**                                                   |
| :-------------------- | :------------------------------------------------------------------- |
| API Integration       | Singleton client with exponential backoff retry (3 attempts, jitter) |
| Security Layer        | Multi-layer validation (Zod schemas + business logic allowlists)     |
| Webhook Processing    | HMAC signature verification with idempotent event handling           |
| Error Handling        | Sanitized user messages; internal details never exposed              |
| State Synchronization | Real-time sync between database, Clerk metadata, and Zustand store   |

### â€¢ Dual-Balance Token System

**Architecture:**

- **Subscription Tokens** (`tokenBalance`) â€” Monthly allocation, resets on renewal (e.g., 1,000 for Pro, 2,500 for Premium)
- **Top-up Tokens** (`topupTokenBalance`) â€” Purchased tokens, persist indefinitely
- **Spending Priority** â€” Subscription tokens consumed first (monthly reset), then top-up tokens (never expire)
- **Balance Preservation** â€” Subscription changes preserve purchased tokens via pure calculation: `newBalance = newCredits + max(0, currentTotal - oldCredits)`

**Example:** User with 1,500 tokens (1,000 subscription + 500 purchased) upgrades to 2,500-credit plan â†’ Final balance: 3,000 tokens (2,500 new subscription + 500 preserved top-up)

### â€¢ Security Implementation (v2.1 Hardened)

**Three-Layer Defense-in-Depth:**

1. **Edge Protection (Zuplo API Gateway)**
   - IP allowlisting for webhooks (Polar's 5 official IPs only)
   - Rate limiting (100 req/min webhooks, 20 req/min checkouts)
   - Comprehensive audit logging with IP, user agent, timestamp

2. **Application Layer**
   - Multi-layer validation (Zod UUID â†’ Business logic allowlist â†’ Runtime auth)
   - HMAC signature verification via Polar SDK on all webhook payloads
   - Database-backed idempotency with stable keys (no timestamps, prevents replay attacks)
   - Atomic transactions with Serializable isolation (prevents race conditions)
   - Zero-trust metadata (token amounts derived from productId only, not client data)

3. **Data Layer**
   - Clerk authentication required for all server actions
   - Row-level security policies on Supabase
   - Transaction audit trail with polarId tracking
   - Error sanitization (no internal details exposed to users)

### â€¢ Webhook Event Handling

**9 Event Types Processed:**

| Event                     | Action                                                      | v2.2 Status |
| :------------------------ | :---------------------------------------------------------- | :---------- |
| `subscription.created`    | First event when subscribing, transitions FREE â†’ ACTIVE     | âœ… NEW      |
| `subscription.active`     | Allocate tier credits, update plan ID, sync Clerk metadata  |             |
| `subscription.updated`    | Recalculate balance preserving top-ups, handle plan changes |             |
| `subscription.canceled`   | Downgrade to free tier at period end                        |             |
| `subscription.revoked`    | Immediate downgrade, clear subscription fields              |             |
| `subscription.uncanceled` | Restore subscription, clear payment warnings                | âœ… v2.3     |
| `subscription.past_due`   | Payment failed flag, UI alert with "Fix Payment" CTA        | âœ… v2.3     |
| `order.paid`              | Process one-time purchases, increment purchased balance     |             |
| `order.refunded`          | Deduct refunded tokens, create audit record                 |             |

**v2.2 Refinements (Jan 28, 2026):**

- âœ… **`subscription.created` Support** â€” Polar sends this event first; state machine now handles it correctly
- âœ… **Clear `freeTrialEndDate`** â€” Explicitly nulled when upgrading from free to paid plans
- âœ… **Duplicate Transaction Prevention** â€” Pre-existence check eliminates constraint errors
- âœ… **Custom UI Implementation** â€” Migrated from Polar portal to in-app subscription management for greater control

**v2.3 Automation & UX (Jan 28, 2026):**

- âœ… **Payment Failure Handling** â€” Complete UX flow for failed payments:
  - `PaymentFailureAlert.tsx` component with prominent "Fix Payment" CTA
  - Alert displays on credits page when `subscription.past_due` webhook received
  - Shows period end date and redirects to Polar portal for secure payment update
  - `ManageSubscriptionBadge.tsx` prioritizes payment failure button above all other actions
  - 2 new test scenarios added to credits page test suite
- âœ… **Reconciliation Cron** â€” Automated DB-Clerk desync detection and healing (daily at 3 AM UTC; Hobby-compatible)
- âœ… **Cleanup Cron** â€” Automated webhook event pruning (daily at 2 AM UTC, 30-day retention)
- âœ… **Cron Security** â€” Bearer token authorization, IP logging, fail-open error handling
- âœ… **Operational Observability** â€” Comprehensive logging of execution metrics, desync rates, cleanup counts

### â€¢ Custom UI Evolution: From Portal to In-App Experience

**Strategic Decision (Jan 28, 2026):** Migrated from Polar's hosted customer portal to **custom React components** for subscription management, achieving **greater control** over user experience and business logic.

**Why Custom UI?**

Initially, the system relied on Polar's customer portal for all subscription operations (cancel, upgrade, downgrade). While functional, this approach had limitations:

- âŒ **Context Switching** â€” Users redirected to external portal, breaking in-app flow
- âŒ **Limited Control** â€” Couldn't customize confirmation dialogs or messaging
- âŒ **Branding Disconnect** â€” External portal didn't match application's design language
- âŒ **No Analytics** â€” Couldn't track user interactions with subscription UI
- âŒ **Inflexible UX** â€” Portal workflow not optimized for our use cases

**Custom Implementation:**

Built **4 custom React components** (1,631 tests) handling common subscription operations in-app:

| **Component**                      | **Responsibility**                       | **Tests** |
| :--------------------------------- | :--------------------------------------- | :-------- |
| `SubscriptionPlans.tsx`            | Plan display, upgrade/downgrade UI       | 520       |
| `ManageSubscriptionBadge.tsx`      | Current plan badge, action buttons       | 292       |
| `ConfirmationDialog.tsx`           | Destructive action confirmations         | 305       |
| `useSubscriptionActions.ts` (hook) | Centralized subscription operation logic | 514       |

**Benefits Achieved:**

- âœ… **Seamless Experience** â€” All subscription actions in-app, no context switching
- âœ… **Full Control** â€” Custom confirmation dialogs with clear, contextual messaging
- âœ… **Consistent Branding** â€” Matches application design system and internationalization (Polish/English)
- âœ… **Enhanced UX** â€” Real-time feedback with granular loading states per action
- âœ… **Business Logic** â€” Payment processing locks prevent concurrent operations
- âœ… **Analytics Ready** â€” Track every user interaction with subscription UI

**Hybrid Approach:**

Smart delegation between custom UI and Polar portal:

| **Operation**           | **Handled By**  | **Reason**                            |
| :---------------------- | :-------------- | :------------------------------------ |
| Subscribe to plan       | âœ… Custom UI    | In-app flow, immediate feedback       |
| Upgrade/Downgrade       | âœ… Custom UI    | Show plan comparison, confirm changes |
| Cancel subscription     | âœ… Custom UI    | Confirmation dialog, show end date    |
| Reactivate subscription | âœ… Custom UI    | One-click reactivation                |
| View current plan       | âœ… Custom UI    | Always visible, integrated with app   |
| Fix failed payment      | âœ… Custom UI    | Alert banner with portal redirect     |
| Update payment method   | ğŸ”„ Polar Portal | PCI compliance, secure card handling  |
| Download invoices       | ğŸ”„ Polar Portal | Tax-compliant documents               |
| View payment history    | ğŸ”„ Polar Portal | Complete transaction records          |
| Manage billing address  | ğŸ”„ Polar Portal | International tax compliance          |

**Technical Architecture:**

```
User clicks "Upgrade to Premium"
         â†“
Custom UI shows confirmation dialog
         â†“
User confirms â†’ Server action (changePlan)
         â†“
Redirect to Polar checkout (payment collection)
         â†“
User completes payment â†’ Polar webhook
         â†“
Database + Clerk metadata sync
         â†“
Frontend polling detects change
         â†“
Custom UI updates (new plan badge, token balance)
```

**Result:** 95% of subscription interactions handled in-app with seamless UX, while Polar portal handles payment-sensitive operations (5% of use cases) requiring regulatory compliance.

### â€¢ Automated Maintenance System (v2.3 â€” Jan 28, 2026)

**Proactive Health & Data Management:**

Implemented **automated cron jobs** to maintain system health and prevent data bloat without manual intervention.

**Reconciliation Cron** (`/api/cron/reconciliation`):

- **Schedule**: Daily at 3:00 AM UTC (Vercel Hobbyâ€“compatible; once per day)
- **Purpose**: Self-healing system that detects and fixes DB-Clerk desynchronization
- **Process**: Scans all users, identifies discrepancies (plan ID, token balance, subscription status), automatically corrects mismatches
- **Monitoring**: Alerts if desync rate exceeds 1%, tracks fix success rate
- **Impact**: Zero manual intervention required; system self-corrects before users notice issues

**Cleanup Cron** (`/api/cron/cleanup`):

- **Schedule**: Daily at 2:00 AM UTC
- **Purpose**: Delete webhook events older than 30 days to prevent database bloat
- **Process**: Removes processed webhook records while maintaining audit trail for debugging
- **Retention**: Configurable 30-day history balances compliance with performance
- **Impact**: Prevents `WebhookEvent` table growth, maintains query performance

**Security Architecture:**

- **Authorization**: Bearer token authentication (`CRON_SECRET`) prevents unauthorized execution
- **IP Logging**: Tracks unauthorized access attempts for security monitoring
- **Fail-Open Design**: Returns 200 on error to prevent Vercel retry storms (next scheduled run will retry)
- **Observability**: Comprehensive logging of execution duration, items processed, failure rates

**Operational Metrics:**

- **Reconciliation**: Typically 0.00% desync rate, sub-300ms execution time
- **Cleanup**: ~15,000 events deleted daily, sub-100ms execution time
- **Reliability**: Zero manual intervention required since deployment

**Test Coverage:** 33 comprehensive tests validating authorization, success scenarios, error handling, and performance across both endpoints.

### â€¢ Quality Assurance & Validation

**Automated Testing:**

- **312 Comprehensive Tests** â€” 87% code coverage across all payment logic (33 tests added for cron automation in v2.3)
- **1,631 UI Component Tests** â€” Custom subscription UI fully tested (520 + 292 + 305 + 514 tests)
- **33 Cron Job Tests** â€” Automated maintenance system fully validated (14 reconciliation + 19 cleanup tests)
- **Financial Standards** â€” Zero tolerance for test failures; all edge cases and error paths verified
- **E2E Scenario Testing** â€” 8 complete user journeys from signup to downgrade validated
- **Idempotency Testing** â€” Duplicate webhook delivery, race conditions, concurrent updates
- **Security Testing** â€” Product ID manipulation, authentication bypass, signature tampering, metadata tampering
- **Integration Testing** â€” Full payment flows with real webhook payloads
- **Cron Security Testing** â€” Authorization validation, unauthorized access logging, error handling, performance

**Live Validation (Jan 28, 2026):**

- âœ… **7 Real User Scenarios** â€” Complete subscription lifecycle tested with actual Polar webhooks
- âœ… **100% Congruency** â€” Verified state synchronization across Polar â†’ Database â†’ Clerk â†’ Frontend
- âœ… **Token Calculations** â€” All upgrade/downgrade/cancel/topup scenarios validated with real data
- âœ… **Webhook Processing** â€” ~40 webhook deliveries processed successfully with proper deduplication
- âœ… **State Machine** â€” All transitions tested (FREE â†’ ACTIVE â†’ CANCELED_PENDING â†’ etc.)
- âœ… **Payment Failure UX** â€” Alert component integrated and tested with 2 new scenarios
- âœ… **Automated Health Checks** â€” Reconciliation and cleanup cron jobs deployed and validated

**Test Execution:** 4,386 tests pass (312 payment + 1,631 UI + 33 cron + 2,410 other)

### â€¢ Comprehensive Documentation

**Seven Complete Guides (367 KB total):**

- **POLAR_IMPLEMENTATION.md** (105 KB) â€” Complete implementation guide, security architecture, custom UI documentation, phase-by-phase build
- **STRIDE_THREAT_MODEL.md** (54 KB) â€” Security threat analysis, attack scenarios, defense-in-depth validation
- **INTEGRATION_TESTING_SUMMARY.md** (9 KB) â€” Live testing results, all 7 scenarios documented, token calculation details
- **DEVELOPER_QUICK_REFERENCE.md** (6 KB) â€” Quick reference for daily work, schemas, debugging tips
- **VALIDATION_REPORT_2026-01-28.md** (13 KB) â€” Complete validation report with before/after comparisons
- **CRON_IMPLEMENTATION.md** (68 KB) â€” Automated maintenance system documentation, cron job architecture, monitoring guide
- **RECOMMENDATIONS.md** (112 KB) â€” Technical recommendations for hardening, observability, and production readiness

**Custom UI Components:**

- `SubscriptionPlans.tsx` â€” Full-featured plan display with upgrade/downgrade/cancel functionality
- `ManageSubscriptionBadge.tsx` â€” Animated current plan badge with action buttons (includes payment failure handling)
- `ConfirmationDialog.tsx` â€” Contextual confirmation dialogs for destructive actions
- `PaymentFailureAlert.tsx` â€” Payment failure notification with "Fix Payment" CTA (v2.3)
- `useSubscriptionActions.ts` â€” React hook centralizing all subscription operations

**Security Rating:** 9.8/10 â­â­â­ (Enterprise-grade with Zuplo edge protection)

</details>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>React 19 Form Architecture</strong> â€” Progressive enhancement, server actions, useActionState</summary>

<div align="center">
<em>Progressive enhancement meets type-safe server actions</em>
</div>

<br/>

Modern form architecture leveraging React 19 hooks and Next.js 16 server actions for optimal DX and performance.

### â€¢ Architecture Overview

| **Component**        | **Responsibility**                 | **Pattern**                                   |
| :------------------- | :--------------------------------- | :-------------------------------------------- |
| Client-Side State    | Form validation & user interaction | React Hook Form with Zod resolver             |
| Server Actions       | Data mutations & persistence       | Next.js 16 `action` prop with `FormData` API  |
| State Management     | Server response handling           | `useActionState` for declarative state        |
| Event Handlers       | Stable callbacks without deps      | `useEffectEvent` for effect event handlers    |
| Field Watching       | Reactive form updates              | `useWatch` for optimized re-renders           |
| Context Architecture | Complex form state sharing         | Provider pattern with memoized context values |

### â€¢ Core Patterns

- **Progressive Enhancement** â€” Forms work without JavaScript using native `FormData` submission, enhanced with client-side validation when available
- **Type-Safe Validation** â€” Dual-layer Zod schema validation (client-side React Hook Form + server-side `safeParse`) ensures data integrity at every boundary
- **Optimized Re-renders** â€” `useWatch` replaces `form.watch()` for granular field subscriptions, eliminating unnecessary component updates
- **Stable Event Handlers** â€” React 19's `useEffectEvent` provides dependency-free callbacks for effect handlers, removing dependency array confusion
- **Data-Driven Rendering** â€” Configuration objects with `map()` eliminate JSX repetition while maintaining type safety and readability

### â€¢ Server Action Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. User submits form â†’ <form action={formAction}>          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. Client-side validation â†’ React Hook Form + Zod          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. FormData serialization â†’ Native browser behavior        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. Server action invoked â†’ useActionState manages pending  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. Server-side validation â†’ Zod safeParse with structured  â”‚
â”‚     error responses                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. Database mutation â†’ Prisma with RLS policies            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  7. Response handling â†’ useEffectEvent for success/error    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### â€¢ Implementation Highlights

- **Context-Based Complex Forms** â€” `VerbAttributesForm` uses provider pattern to share state across nested components without prop drilling
- **Field-Level Subscriptions** â€” Single `useWatch` call for multiple fields, maintaining React Hook Form's optimization benefits
- **Structured Error Handling** â€” Server actions return typed `ActionState<T>` with success/error/data discriminated unions
- **Test Coverage** â€” Forms tested with `data-testid` attributes (never text content), ensuring reliable test stability across i18n and content changes

### â€¢ Example Architecture

```typescript
// Server Action with safeParse validation
export async function submitFormAction(
  prevState: ActionState<DataType>,
  formData: FormData,
): Promise<ActionState<DataType>> {
  const result = schema.safeParse(Object.fromEntries(formData));
  if (!result.success) {
    return { success: false, errors: result.error.flatten().fieldErrors };
  }
  // ... database mutation
  return { success: true, data: createdRecord };
}

// Client Component
const [actionState, formAction, isPending] = useActionState(
  submitFormAction,
  initialState,
);
const watched = useWatch({ control: form.control }); // Single subscription

const handleSuccess = useEffectEvent(() => {
  toast({ title: 'Success!' });
  onSuccess?.();
}); // No dependency array needed!

useEffect(() => {
  if (actionState.success) handleSuccess();
}, [actionState.success]);
```

</details>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>Tambo AI Learning Assistant</strong> â€” Context-aware conversational AI, persistent threads, interactive components</summary>

<div align="center">
<em>Context-aware conversational AI with persistent threads and interactive components</em>
</div>

<br/>

A sophisticated AI tutoring system powered by Tambo SDK, providing personalized Polish language instruction with full conversation persistence and custom interactive learning components.

### â€¢ Architecture Overview

| **Component**      | **Responsibility**                  | **Pattern**                                   |
| :----------------- | :---------------------------------- | :-------------------------------------------- |
| TamboProvider      | SDK initialization & thread context | React Context with auth token injection       |
| Thread Persistence | Conversation state management       | localStorage + PostgreSQL hybrid storage      |
| Message Streaming  | Real-time AI response delivery      | Server-Sent Events with generation stages     |
| Component Registry | Dynamic UI rendering from AI        | Zod-validated props with component mapping    |
| Tool Registry      | AI function calling capabilities    | Type-safe tool definitions with input schemas |
| Token Charging     | Usage-based billing integration     | Pre-charge with actual usage reconciliation   |

### â€¢ Key Features

- **Thread-Based Conversations** â€” Full conversation history preserved across sessions with automatic restoration on page load
- **Lab-Specific Context** â€” AI tutor adapts to current learning module (Aspect Master, Reflexive Lab, Preposition Lab, etc.)
- **Custom Interactive Components** â€” AI can render learning-specific UI:
  - `LearningHintCard` â€” Contextual tips with difficulty levels and examples
  - `ExerciseGenerator` â€” Interactive quizzes with real Polish content
  - `ProgressVisualization` â€” Learning analytics with charts and statistics
- **Thread Management** â€” Archive conversations with titles/subtitles, restore previous threads, delete old conversations
- **Message Limits** â€” Configurable per-thread message caps with graceful degradation
- **Token-Based Costing** â€” Integrated with platform credit system, pre-authorization with actual usage tracking

### â€¢ Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AITutorAssistant                                           â”‚
â”‚  â”œâ”€â”€ TamboProvider (SDK Context)                            â”‚
â”‚  â”‚   â”œâ”€â”€ useTamboThread (conversation state)                â”‚
â”‚  â”‚   â””â”€â”€ useTamboThreadInput (message handling)             â”‚
â”‚  â”œâ”€â”€ ChatHeader                                             â”‚
â”‚  â”‚   â”œâ”€â”€ ThreadSelector (dropdown with archived threads)    â”‚
â”‚  â”‚   â””â”€â”€ ThreadArchiveForm (save with title/subtitle)       â”‚
â”‚  â”œâ”€â”€ MessageList                                            â”‚
â”‚  â”‚   â”œâ”€â”€ MessageItem (user/assistant messages)              â”‚
â”‚  â”‚   â”œâ”€â”€ MarkdownRenderer (formatted responses)             â”‚
â”‚  â”‚   â””â”€â”€ LoadingIndicator (streaming state)                 â”‚
â”‚  â”œâ”€â”€ ChatInput (textarea with send button)                  â”‚
â”‚  â””â”€â”€ QuickSuggestions (one-click prompts)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### â€¢ Thread Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Thread Creation & Persistence Flow                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. User opens lab â†’ Check localStorage for saved threadId  â”‚
â”‚  2. If found â†’ Restore thread with retry logic (3 attempts) â”‚
â”‚  3. If not â†’ Create new thread on first message             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. Messages sent â†’ Real-time streaming response            â”‚
â”‚  5. Thread auto-saved â†’ localStorage + database sync        â”‚
â”‚  6. Message count tracked â†’ Update database periodically    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  7. User archives â†’ Save title/subtitle, mark as archived   â”‚
â”‚  8. New thread created â†’ localStorage cleared, fresh start  â”‚
â”‚  9. User can restore â†’ Select from dropdown, switch thread  â”‚
â”‚  10. User can delete â†’ Permanent removal from database      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### â€¢ Custom Hooks

| **Hook**                | **Purpose**                                          |
| :---------------------- | :--------------------------------------------------- |
| `useThreadPersistence`  | localStorage management, thread ID tracking, restore |
| `useThreadDatabase`     | Background sync of thread metadata to PostgreSQL     |
| `useActualUsageLogging` | Token usage tracking after AI response completion    |

### â€¢ AI-Rendered Components

The AI can dynamically render interactive learning components by returning structured JSON:

```typescript
// AI returns component specification
{
  "component": "ExerciseGenerator",
  "props": {
    "title": "Verb Aspect Practice",
    "exercises": [
      {
        "question": "Wczoraj _____ (czytaÄ‡/przeczytaÄ‡) ksiÄ…Å¼kÄ™ przez caÅ‚y dzieÅ„.",
        "options": ["czytaÅ‚em", "przeczytaÅ‚em", "czytam"],
        "correctAnswer": "czytaÅ‚em",
        "explanation": "Use imperfective 'czytaÅ‚em' for duration"
      }
    ]
  }
}

// Component registry maps to React component with Zod validation
const tamboComponents = [
  { name: 'ExerciseGenerator', component: ExerciseGenerator, propsSchema: exerciseGeneratorSchema },
  { name: 'LearningHintCard', component: LearningHintCard, propsSchema: learningHintCardSchema },
  { name: 'ProgressVisualization', component: ProgressVisualization, propsSchema: progressVisualizationSchema }
];
```

### â€¢ Database Schema

```sql
model TamboThread {
  id          String    @id @default(cuid())
  userId      String
  labContext  String    -- "aspect-master", "reflexive-lab", etc.
  threadId    String    -- Tambo SDK thread identifier
  title       String?   -- User-provided archive title
  subtitle    String?   -- Optional description
  isCurrent   Boolean   @default(true)
  isArchived  Boolean   @default(false)
  messageCount Int      @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  archivedAt  DateTime?

  @@unique([userId, labContext, threadId])
}
```

### â€¢ Testing Strategy

- **122+ tests** covering Tambo components and integration
- **Component isolation** â€” Each UI component tested independently with mocked Tambo hooks
- **Integration tests** â€” Full AITutorAssistant flow with mocked SDK responses
- **Server action tests** â€” Thread CRUD operations with Prisma mocking

</details>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><path d="M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719"/></svg>Real-Time Chat with Stream & Firebase Push Notifications</strong> â€” Multi-tenant messaging, FCM push</summary>

<div align="center">
<em>Multi-tenant messaging with cross-platform push notification delivery</em>
</div>

<br/>

A production-grade real-time chat system built on Stream Chat SDK with Firebase Cloud Messaging (FCM) integration for reliable push notifications across web, Android, and iOS.

### â€¢ Architecture Overview

| **Component**       | **Responsibility**                       | **Pattern**                                      |
| :------------------ | :--------------------------------------- | :----------------------------------------------- |
| Stream Chat Client  | Real-time messaging & channel management | Singleton with Clerk authentication              |
| Firebase Messaging  | Push notification delivery               | FCM with service worker background handling      |
| Push Template API   | Server-side notification configuration   | Stream Chat Push v3 with Handlebars templates    |
| Device Registration | FCM token management with Stream         | `addDevice()`/`removeDevice()` with localStorage |
| Service Worker      | Background notification handling         | Firebase Messaging SW with message listener      |
| Company Isolation   | Multi-tenant user filtering              | Clerk ID validation with company-scoped queries  |

### â€¢ Core Features

- **Multi-Tenant Messaging** â€” Users can only chat with members of their organization through Clerk ID validation and company-scoped user queries
- **Real-Time Updates** â€” Instant message delivery with typing indicators, read receipts, and presence status via Stream Chat WebSocket
- **Channel Management** â€” Create, archive, and restore conversation channels with persistent state across sessions
- **Per-Channel Muting** â€” Users can mute specific channels while maintaining global notification settings
- **Responsive Design** â€” Adaptive sidebar/channel layout with mobile-first breakpoint management
- **Internationalization** â€” Polish language support with custom translations via Streami18n

### â€¢ Push Notification Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Push Notification Flow (Stream Chat Push v3 + Firebase)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. User enables notifications â†’ Browser permission request â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. Permission granted â†’ Firebase SDK requests FCM token    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. FCM token obtained â†’ Register with Stream Chat          â”‚
â”‚     via client.addDevice(token, 'firebase', userId)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. Push template configured â†’ Stream API receives template â”‚
â”‚     with platform-specific notification payloads            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. New message event â†’ Stream sends to Firebase servers    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. Firebase delivers â†’ Service worker receives & displays  â”‚
â”‚     notification even when app is backgrounded/closed       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### â€¢ Multi-Platform Push Template

Stream Chat Push v3 uses Handlebars-style templates for customizable notifications:

```json
{
  "data": {
    "version": "v2",
    "sender": "stream.chat",
    "type": "{{ event_type }}",
    "channel_id": "{{ channel.id }}",
    "message_id": "{{ message.id }}"
  },
  "android": {
    "priority": "high",
    "notification": {
      "title": "{{ sender.name }}",
      "body": "{{ truncate message.text 150 }}",
      "sound": "default"
    }
  },
  "webpush": {
    "notification": {
      "title": "{{ sender.name }}",
      "body": "{{ truncate message.text 150 }}",
      "icon": "{{ sender.image }}"
    },
    "fcm_options": { "link": "/chat" }
  },
  "apns": {
    "payload": {
      "aps": {
        "alert": {
          "title": "New message from {{ sender.name }}",
          "body": "{{ truncate message.text 150 }}"
        },
        "badge": "{{ unread_count }}",
        "sound": "default"
      }
    }
  }
}
```

### â€¢ Component Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatPage                                                   â”‚
â”‚  â”œâ”€â”€ Chat (Stream Chat Provider)                            â”‚
â”‚  â”‚   â”œâ”€â”€ ChannelIdHandler (deep-link support)               â”‚
â”‚  â”‚   â”œâ”€â”€ ChannelRestorer (session persistence)              â”‚
â”‚  â”‚   â”œâ”€â”€ ChatSidebar                                        â”‚
â”‚  â”‚   â”‚   â”œâ”€â”€ ChannelList (filterable channel list)          â”‚
â”‚  â”‚   â”‚   â””â”€â”€ UserSearch (company-scoped user discovery)     â”‚
â”‚  â”‚   â””â”€â”€ ChatChannel                                        â”‚
â”‚  â”‚       â”œâ”€â”€ Menubar                                        â”‚
â”‚  â”‚       â”‚   â”œâ”€â”€ ThemeToggle                                â”‚
â”‚  â”‚       â”‚   â””â”€â”€ PushSubscriptionToggleButton               â”‚
â”‚  â”‚       â”œâ”€â”€ CustomChannelHeader                            â”‚
â”‚  â”‚       â”‚   â””â”€â”€ ChannelNotificationToggle (per-channel)    â”‚
â”‚  â”‚       â”œâ”€â”€ MessageList                                    â”‚
â”‚  â”‚       â””â”€â”€ MessageInput                                   â”‚
â”‚  â””â”€â”€ usePushNotifications (FCM hook)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### â€¢ Security & Multi-Tenancy

| **Security Layer**      | **Implementation**                                        |
| :---------------------- | :-------------------------------------------------------- |
| User Authentication     | Clerk-issued tokens validated on both client and server   |
| Company Isolation       | Clerk ID format validation (`user_[a-zA-Z0-9_]+`)         |
| Device Token Management | FCM tokens stored locally, registered server-side only    |
| Push Template Auth      | Server action with `auth()` guard before Stream API calls |
| Channel Access Control  | Stream Chat channel membership enforced at SDK level      |

### â€¢ Push Notification Hook

The `usePushNotifications` hook manages the complete FCM lifecycle:

```typescript
interface UsePushNotificationsReturn {
  isSupported: boolean; // Browser supports notifications & Firebase configured
  isEnabled: boolean; // User granted permission
  isLoading: boolean; // Operation in progress
  error: string | null; // Last error message
  enablePushNotifications: () => Promise<boolean>;
  disablePushNotifications: () => Promise<boolean>;
}

// Key responsibilities:
// 1. Check browser support & Firebase configuration
// 2. Register Firebase service worker
// 3. Request notification permission
// 4. Obtain and cache FCM token
// 5. Register/unregister device with Stream Chat
// 6. Auto-register on client reconnection
```

### â€¢ Service Worker Implementation

The Firebase Messaging service worker handles background notifications:

```javascript
// firebase-messaging-sw.js
importScripts('firebase/firebase-app-compat.js');
importScripts('firebase/firebase-messaging-compat.js');

// Receive config from main app via postMessage
self.addEventListener('message', (event) => {
  if (event.data?.type === 'FIREBASE_CONFIG') {
    firebase.initializeApp(event.data.config);
    const messaging = firebase.messaging();

    messaging.onBackgroundMessage((payload) => {
      const { title, body, icon } = payload.notification;
      self.registration.showNotification(title, { body, icon });
    });
  }
});
```

</details>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><path d="M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2"/><path d="M6.453 15h11.094"/><path d="M8.5 2h7"/></svg>Testing & Quality</strong> â€” Jest, Playwright, k6, Artillery, type safety</summary>

PoliLex is validated with a **full testing pipeline** that combines automated tests, static analysis, and load testing.  
Every change is validated through:

- **Automated unit and integration suites** using **Jest** and **React Testing Library** for components and business logic
- **End-to-end regression tests** with **Playwright** for critical user journeys in the browser
- **Load and performance exercises** with **k6** and **Artillery** focused on core APIs, server-side operations, and caching behavior
- **Strict static typing and schema validation** with **TypeScript (strict mode)**, **Prisma**, **Zod**, and **@t3-oss/env-nextjs** for data, inputs, and configuration
- **Automated linting and formatting** with **ESLint**, **Prettier**, and import-sorting to enforce consistent, production-grade code quality

</details>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>Resources & Links</strong></summary>

<div align="center">

[![Watch Demo](https://img.shields.io/badge/YouTube-Watch%20Demo-red?style=for-the-badge&logo=youtube&logoColor=white)](https://www.youtube.com/watch?v=1Q7oyvCVanE)

</div>

</details>

<details style="margin-bottom: 16px;">
<summary style="cursor: pointer; font-size: 1.1rem;"><strong><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f97316" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.2em;display:inline-block;margin-right:6px"><path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"/><path d="M22 10v6"/><path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"/></svg>Background</strong> â€” Education, training, specialization</summary>

<table width="100%" style="font-size: 16px;">
<tr>
<td width="33%" style="text-align: center; padding: 12px; border: 1px solid #374151; background-color: #1f2937;"><strong>Education</strong></td>
<td width="33%" style="text-align: center; padding: 12px; border: 1px solid #374151; background-color: #1f2937;"><strong>Training</strong></td>
<td width="34%" style="text-align: center; padding: 12px; border: 1px solid #374151; background-color: #1f2937;"><strong>Specialization</strong></td>
</tr>
<tr>
<td style="text-align: center; padding: 12px; border: 1px solid #374151;"><strong>Boolean UK Graduate</strong><br>Full-stack development fundamentals</td>
<td style="text-align: center; padding: 12px; border: 1px solid #374151;"><strong>JS Mastery Graduate</strong><br>(Feb 2024) - Advanced React & Next.js Masterclass</td>
<td style="text-align: center; padding: 12px; border: 1px solid #374151;"><strong>Polish Language Enthusiast</strong><br>Combined technical expertise with language learning</td>
</tr>
</table>

</details>

---

<div align="center">
  <sub style="font-size: 14px;">ğŸ’¡ Always learning, always building. Currently exploring advanced AI integration and enterprise-scale applications.</sub>
</div>
